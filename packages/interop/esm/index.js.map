{"version":3,"file":"index.js","names":["types","t","config","library","isLibrary","RegExp","s","test","fixer","path","isTemplateLiteral","parent","listKey","original","node","replaceWithSourceString","args","get","Array","isArray","replaceWith","visitors","MemberExpression","Identifier","visitor","TaggedTemplateExpression","tag","identifier","isIdentifier","isMemberExpression","isCallExpression","obj","scope","binding","getBinding","name","parentPath","isImportDeclaration","importSource","source","value","traverse"],"sources":["../src/index.ts"],"sourcesContent":["import type core from '@babel/core';\nimport type { NodePath } from '@babel/traverse';\nimport type {\n  Expression,\n  Identifier,\n  MemberExpression,\n  TaggedTemplateExpression,\n  V8IntrinsicIdentifier,\n} from '@babel/types';\n\nexport declare type Core = typeof core;\n\nexport default (\n  { types: t }: Core,\n  config: { library?: string | RegExp } = {}\n) => {\n  const library = config.library || 'styled-components';\n  const isLibrary: (s: string) => boolean =\n    library instanceof RegExp ? (s) => library.test(s) : (s) => s === library;\n\n  const fixer = (path: NodePath<MemberExpression> | NodePath<Identifier>) => {\n    if (!t.isTemplateLiteral(path.parent) || path.listKey !== 'expressions') {\n      return;\n    }\n\n    const original = path.node;\n    path.replaceWithSourceString(\n      \"(i => i && i.__linaria ? '.' + i.__linaria.className : i)('placeholder')\"\n    );\n\n    const args = path.get('arguments');\n    if (Array.isArray(args)) {\n      args[0]?.replaceWith(original);\n    }\n  };\n\n  const visitors = {\n    MemberExpression: fixer,\n    Identifier: fixer,\n  };\n\n  return {\n    visitor: {\n      TaggedTemplateExpression(path: NodePath<TaggedTemplateExpression>) {\n        const tag = path.get('tag');\n        let identifier: NodePath<Expression | V8IntrinsicIdentifier> | null =\n          null;\n        if (tag.isIdentifier()) {\n          identifier = tag;\n        } else if (tag.isMemberExpression()) {\n          identifier = tag.get('object');\n        } else if (tag.isCallExpression()) {\n          identifier = tag.get('callee');\n        } else {\n          return;\n        }\n\n        if (identifier.isMemberExpression()) {\n          const obj = identifier.get('object');\n          // it's something like styled().attrs()\n          if (obj.isCallExpression()) {\n            identifier = obj.get('callee');\n          } else if (obj.isMemberExpression()) {\n            identifier = obj.get('object');\n          }\n        }\n\n        if (!identifier.isIdentifier()) {\n          return;\n        }\n\n        const { scope } = identifier;\n        const binding = scope.getBinding(identifier.node.name);\n        const parent = binding?.path.parentPath ?? null;\n        if (!parent?.isImportDeclaration()) {\n          return;\n        }\n\n        const importSource = parent.node.source.value;\n        if (isLibrary(importSource)) {\n          path.get('quasi').traverse(visitors);\n        }\n      },\n    },\n  };\n};\n"],"mappings":"AAYA,gBAAe,CACb;EAAEA,KAAK,EAAEC;AAAQ,CAAC,EAClBC,MAAqC,GAAG,CAAC,CAAC,KACvC;EACH,MAAMC,OAAO,GAAGD,MAAM,CAACC,OAAO,IAAI,mBAAmB;EACrD,MAAMC,SAAiC,GACrCD,OAAO,YAAYE,MAAM,GAAIC,CAAC,IAAKH,OAAO,CAACI,IAAI,CAACD,CAAC,CAAC,GAAIA,CAAC,IAAKA,CAAC,KAAKH,OAAO;EAE3E,MAAMK,KAAK,GAAIC,IAAuD,IAAK;IACzE,IAAI,CAACR,CAAC,CAACS,iBAAiB,CAACD,IAAI,CAACE,MAAM,CAAC,IAAIF,IAAI,CAACG,OAAO,KAAK,aAAa,EAAE;MACvE;IACF;IAEA,MAAMC,QAAQ,GAAGJ,IAAI,CAACK,IAAI;IAC1BL,IAAI,CAACM,uBAAuB,CAC1B,0EAA0E,CAC3E;IAED,MAAMC,IAAI,GAAGP,IAAI,CAACQ,GAAG,CAAC,WAAW,CAAC;IAClC,IAAIC,KAAK,CAACC,OAAO,CAACH,IAAI,CAAC,EAAE;MACvBA,IAAI,CAAC,CAAC,CAAC,EAAEI,WAAW,CAACP,QAAQ,CAAC;IAChC;EACF,CAAC;EAED,MAAMQ,QAAQ,GAAG;IACfC,gBAAgB,EAAEd,KAAK;IACvBe,UAAU,EAAEf;EACd,CAAC;EAED,OAAO;IACLgB,OAAO,EAAE;MACPC,wBAAwB,CAAChB,IAAwC,EAAE;QACjE,MAAMiB,GAAG,GAAGjB,IAAI,CAACQ,GAAG,CAAC,KAAK,CAAC;QAC3B,IAAIU,UAA+D,GACjE,IAAI;QACN,IAAID,GAAG,CAACE,YAAY,EAAE,EAAE;UACtBD,UAAU,GAAGD,GAAG;QAClB,CAAC,MAAM,IAAIA,GAAG,CAACG,kBAAkB,EAAE,EAAE;UACnCF,UAAU,GAAGD,GAAG,CAACT,GAAG,CAAC,QAAQ,CAAC;QAChC,CAAC,MAAM,IAAIS,GAAG,CAACI,gBAAgB,EAAE,EAAE;UACjCH,UAAU,GAAGD,GAAG,CAACT,GAAG,CAAC,QAAQ,CAAC;QAChC,CAAC,MAAM;UACL;QACF;QAEA,IAAIU,UAAU,CAACE,kBAAkB,EAAE,EAAE;UACnC,MAAME,GAAG,GAAGJ,UAAU,CAACV,GAAG,CAAC,QAAQ,CAAC;UACpC;UACA,IAAIc,GAAG,CAACD,gBAAgB,EAAE,EAAE;YAC1BH,UAAU,GAAGI,GAAG,CAACd,GAAG,CAAC,QAAQ,CAAC;UAChC,CAAC,MAAM,IAAIc,GAAG,CAACF,kBAAkB,EAAE,EAAE;YACnCF,UAAU,GAAGI,GAAG,CAACd,GAAG,CAAC,QAAQ,CAAC;UAChC;QACF;QAEA,IAAI,CAACU,UAAU,CAACC,YAAY,EAAE,EAAE;UAC9B;QACF;QAEA,MAAM;UAAEI;QAAM,CAAC,GAAGL,UAAU;QAC5B,MAAMM,OAAO,GAAGD,KAAK,CAACE,UAAU,CAACP,UAAU,CAACb,IAAI,CAACqB,IAAI,CAAC;QACtD,MAAMxB,MAAM,GAAGsB,OAAO,EAAExB,IAAI,CAAC2B,UAAU,IAAI,IAAI;QAC/C,IAAI,CAACzB,MAAM,EAAE0B,mBAAmB,EAAE,EAAE;UAClC;QACF;QAEA,MAAMC,YAAY,GAAG3B,MAAM,CAACG,IAAI,CAACyB,MAAM,CAACC,KAAK;QAC7C,IAAIpC,SAAS,CAACkC,YAAY,CAAC,EAAE;UAC3B7B,IAAI,CAACQ,GAAG,CAAC,OAAO,CAAC,CAACwB,QAAQ,CAACpB,QAAQ,CAAC;QACtC;MACF;IACF;EACF,CAAC;AACH,CAAC"}