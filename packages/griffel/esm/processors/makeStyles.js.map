{"version":3,"file":"makeStyles.js","names":["resolveStyleRulesForSlots","BaseProcessor","validateParams","MakeStylesProcessor","cssClassMap","cssRulesByBucket","slotsExpName","constructor","params","args","callee","callParam","ex","type","name","value","asSelector","Error","build","valueCache","slots","get","doEvaltimeReplacement","replacer","doRuntimeReplacement","t","astService","importedStyles","addNamedImport","objectExpression","Object","entries","map","slot","classesMap","objectProperty","identifier","className","classValue","Array","isArray","arrayExpression","i","stringLiteral","bucket","rules","rule","stylesCall","callExpression","nullLiteral","toString"],"sources":["../../src/processors/makeStyles.ts"],"sourcesContent":["/* eslint-disable class-methods-use-this */\nimport type { Expression } from '@babel/types';\nimport { resolveStyleRulesForSlots } from '@griffel/core';\nimport type {\n  StylesBySlots,\n  CSSClassesMapBySlot,\n  CSSRulesByBucket,\n} from '@griffel/core/types';\n\nimport type { ValueCache, Params, TailProcessorParams } from '@linaria/tags';\nimport { BaseProcessor, validateParams } from '@linaria/tags';\n\nexport default class MakeStylesProcessor extends BaseProcessor {\n  #cssClassMap: CSSClassesMapBySlot<string> | undefined;\n\n  #cssRulesByBucket: CSSRulesByBucket | undefined;\n\n  readonly #slotsExpName: string | number | boolean | null;\n\n  public constructor(params: Params, ...args: TailProcessorParams) {\n    validateParams(\n      params,\n      ['callee', 'call'],\n      'Invalid usage of `makeStyles` tag'\n    );\n    const [callee, callParam] = params;\n\n    super([callee], ...args);\n\n    const { ex } = callParam[1];\n    if (ex.type === 'Identifier') {\n      this.#slotsExpName = ex.name;\n    } else if (ex.type === 'NullLiteral') {\n      this.#slotsExpName = null;\n    } else {\n      this.#slotsExpName = ex.value;\n    }\n  }\n\n  public override get asSelector(): string {\n    throw new Error('The result of makeStyles cannot be used as a selector.');\n  }\n\n  public override build(valueCache: ValueCache) {\n    const slots = valueCache.get(this.#slotsExpName) as StylesBySlots<string>;\n    [this.#cssClassMap, this.#cssRulesByBucket] =\n      resolveStyleRulesForSlots(slots);\n  }\n\n  public override doEvaltimeReplacement(): void {\n    this.replacer(this.value, false);\n  }\n\n  public override doRuntimeReplacement(): void {\n    if (!this.#cssClassMap || !this.#cssRulesByBucket) {\n      throw new Error(\n        'Styles are not extracted yet. Please call `build` first.'\n      );\n    }\n\n    const t = this.astService;\n\n    const importedStyles = t.addNamedImport('__styles', '@griffel/react');\n\n    const cssClassMap = t.objectExpression(\n      Object.entries(this.#cssClassMap).map(([slot, classesMap]) => {\n        return t.objectProperty(\n          t.identifier(slot),\n          t.objectExpression(\n            Object.entries(classesMap).map(([className, classValue]) =>\n              t.objectProperty(\n                t.identifier(className),\n                Array.isArray(classValue)\n                  ? t.arrayExpression(classValue.map((i) => t.stringLiteral(i)))\n                  : t.stringLiteral(classValue)\n              )\n            )\n          )\n        );\n      })\n    );\n\n    const cssRulesByBucket = t.objectExpression(\n      Object.entries(this.#cssRulesByBucket).map(([bucket, rules]) => {\n        return t.objectProperty(\n          t.identifier(bucket),\n          t.arrayExpression(\n            // FIXME: rule can be [string, Record<string, unknown>]\n            rules.map((rule) => t.stringLiteral(rule as string))\n          )\n        );\n      })\n    );\n\n    const stylesCall = t.callExpression(importedStyles, [\n      cssClassMap,\n      cssRulesByBucket,\n    ]);\n    this.replacer(stylesCall, true);\n  }\n\n  public override get value(): Expression {\n    return this.astService.nullLiteral();\n  }\n\n  public override toString(): string {\n    return `${super.toString()}(â€¦)`;\n  }\n}\n"],"mappings":"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"}